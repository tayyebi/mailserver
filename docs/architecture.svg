<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1698px" preserveAspectRatio="none" style="width:2418px;height:1698px;" version="1.1" viewBox="0 0 2418 1698" width="2418px" zoomAndPan="magnify"><defs/><g><rect fill="#F0F8FF" height="1683.7266" style="stroke: #A80036; stroke-width: 1.0;" width="1881.5" x="201.5" y="4"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="248" x="1018.25" y="16.0669">Mail Server Host (Debian/Ubuntu)</text><rect fill="#FFFFFF" height="145.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="281.5" y="588.3828"/><rect fill="#FFFFFF" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="459" y="617.5156"/><rect fill="#FFFFFF" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="648.5" y="675.7813"/><rect fill="#FFFFFF" height="396.2578" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1039" y="871.7109"/><rect fill="#FFFFFF" height="130.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1246.5" y="915.9766"/><rect fill="#FFFFFF" height="147.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1429" y="1090.9063"/><rect fill="#FFFFFF" height="44.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1633" y="1165.4375"/><rect fill="#FFFFFF" height="73.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1817.5" y="1514.0313"/><rect fill="#FFFFFF" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2170.5" y="1355.3672"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="49" x2="49" y1="101.7266" y2="1605.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="286.5" x2="286.5" y1="101.7266" y2="1605.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="463.5" x2="463.5" y1="101.7266" y2="1605.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="653.5" x2="653.5" y1="101.7266" y2="1605.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="842.5" x2="842.5" y1="101.7266" y2="1605.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1043.5" x2="1043.5" y1="101.7266" y2="1605.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1251.5" x2="1251.5" y1="101.7266" y2="1605.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1433.5" x2="1433.5" y1="101.7266" y2="1605.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1638" x2="1638" y1="101.7266" y2="1605.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1822" x2="1822" y1="101.7266" y2="1605.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2033" x2="2033" y1="101.7266" y2="1605.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2175" x2="2175" y1="101.7266" y2="1605.4297"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2297" x2="2297" y1="101.7266" y2="1605.4297"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="77" x="8" y="98.4248">User (MUA)</text><ellipse cx="49.5" cy="32.4297" fill="#FEFECE" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M49.5,40.4297 L49.5,67.4297 M36.5,48.4297 L62.5,48.4297 M49.5,67.4297 L36.5,82.4297 M49.5,67.4297 L62.5,82.4297 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="77" x="8" y="1617.4248">User (MUA)</text><ellipse cx="49.5" cy="1630.7266" fill="#FEFECE" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M49.5,1638.7266 L49.5,1665.7266 M36.5,1646.7266 L62.5,1646.7266 M49.5,1665.7266 L36.5,1680.7266 M49.5,1665.7266 L62.5,1680.7266 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="122" x="225.5" y="54.1328"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="264" y="74.1279">Postfix</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="232.5" y="90.4248">(postfix.service)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="122" x="225.5" y="1604.4297"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="264" y="1624.4248">Postfix</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="108" x="232.5" y="1640.7217">(postfix.service)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="397.5" y="54.1328"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="435" y="74.1279">Dovecot</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="404.5" y="90.4248">(dovecot.service)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="397.5" y="1604.4297"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="58" x="435" y="1624.4248">Dovecot</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="404.5" y="1640.7217">(dovecot.service)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="146" x="580.5" y="54.1328"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="617" y="74.1279">OpenDKIM</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="132" x="587.5" y="90.4248">(opendkim.service)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="146" x="580.5" y="1604.4297"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="617" y="1624.4248">OpenDKIM</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="132" x="587.5" y="1640.7217">(opendkim.service)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="776.5" y="54.1328"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="820.5" y="74.1279">Postfix</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="783.5" y="90.4248">(Queue/Cleanup)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="133" x="776.5" y="1604.4297"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="820.5" y="1624.4248">Postfix</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="119" x="783.5" y="1640.7217">(Queue/Cleanup)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="959.5" y="54.1328"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="997.5" y="74.1279">Content Filter</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="966.5" y="90.4248">(pixel-content-filter.sh)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="959.5" y="1604.4297"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="93" x="997.5" y="1624.4248">Content Filter</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="966.5" y="1640.7217">(pixel-content-filter.sh)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="146" x="1178.5" y="54.1328"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="1215.5" y="74.1279">Pixel Milter</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="132" x="1185.5" y="90.4248">(pixelmilter.service)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="146" x="1178.5" y="1604.4297"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="1215.5" y="1624.4248">Pixel Milter</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="132" x="1185.5" y="1640.7217">(pixelmilter.service)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="1374.5" y="54.1328"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="1381.5" y="74.1279">Postfix Reinject</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="1408" y="90.4248">(Binary)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="1374.5" y="1604.4297"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="1381.5" y="1624.4248">Postfix Reinject</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="52" x="1408" y="1640.7217">(Binary)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="1579" y="54.1328"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="1615.5" y="74.1279">Postfix</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="1586" y="90.4248">(smtpd:10025)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="1579" y="1604.4297"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="1615.5" y="1624.4248">Postfix</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="1586" y="1640.7217">(smtpd:10025)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="1747" y="54.1328"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1783" y="74.1279">Pixel Server</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="137" x="1754" y="90.4248">(pixelserver.service)</text><rect fill="#FEFECE" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="1747" y="1604.4297"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1783" y="1624.4248">Pixel Server</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="137" x="1754" y="1640.7217">(pixelserver.service)</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="1988" y="82.1279">Shared Data</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="1990" y="98.4248">(JSON/Logs)</text><path d="M2015.5,33.1328 C2015.5,23.1328 2033.5,23.1328 2033.5,23.1328 C2033.5,23.1328 2051.5,23.1328 2051.5,33.1328 L2051.5,59.1328 C2051.5,69.1328 2033.5,69.1328 2033.5,69.1328 C2033.5,69.1328 2015.5,69.1328 2015.5,59.1328 L2015.5,33.1328 " fill="#FEFECE" style="stroke: #000000; stroke-width: 1.5;"/><path d="M2015.5,33.1328 C2015.5,43.1328 2033.5,43.1328 2033.5,43.1328 C2033.5,43.1328 2051.5,43.1328 2051.5,33.1328 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="85" x="1988" y="1617.4248">Shared Data</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="1990" y="1633.7217">(JSON/Logs)</text><path d="M2015.5,1647.0234 C2015.5,1637.0234 2033.5,1637.0234 2033.5,1637.0234 C2033.5,1637.0234 2051.5,1637.0234 2051.5,1647.0234 L2051.5,1673.0234 C2051.5,1683.0234 2033.5,1683.0234 2033.5,1683.0234 C2033.5,1683.0234 2015.5,1683.0234 2015.5,1673.0234 L2015.5,1647.0234 " fill="#FEFECE" style="stroke: #000000; stroke-width: 1.5;"/><path d="M2015.5,1647.0234 C2015.5,1657.0234 2033.5,1657.0234 2033.5,1657.0234 C2033.5,1657.0234 2051.5,1657.0234 2051.5,1647.0234 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="2119" y="70.4297"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="2126" y="90.4248">Recipient MTA</text><rect fill="#FEFECE" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="2119" y="1604.4297"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="2126" y="1624.4248">Recipient MTA</text><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="2262" y="98.4248">Recipient</text><ellipse cx="2297.5" cy="32.4297" fill="#FEFECE" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M2297.5,40.4297 L2297.5,67.4297 M2284.5,48.4297 L2310.5,48.4297 M2297.5,67.4297 L2284.5,82.4297 M2297.5,67.4297 L2310.5,82.4297 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="Helvetica" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="2262" y="1617.4248">Recipient</text><ellipse cx="2297.5" cy="1630.7266" fill="#FEFECE" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M2297.5,1638.7266 L2297.5,1665.7266 M2284.5,1646.7266 L2310.5,1646.7266 M2297.5,1665.7266 L2284.5,1680.7266 M2297.5,1665.7266 L2310.5,1680.7266 " fill="none" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FFFFFF" height="145.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="281.5" y="588.3828"/><rect fill="#FFFFFF" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="459" y="617.5156"/><rect fill="#FFFFFF" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="648.5" y="675.7813"/><rect fill="#FFFFFF" height="396.2578" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1039" y="871.7109"/><rect fill="#FFFFFF" height="130.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1246.5" y="915.9766"/><rect fill="#FFFFFF" height="147.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1429" y="1090.9063"/><rect fill="#FFFFFF" height="44.2656" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1633" y="1165.4375"/><rect fill="#FFFFFF" height="73.3984" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1817.5" y="1514.0313"/><rect fill="#FFFFFF" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="2170.5" y="1355.3672"/><path d="M184,116.7266 L184,171.7266 L388,171.7266 L388,126.7266 L378,116.7266 L184,116.7266 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M378,116.7266 L378,126.7266 L388,126.7266 L378,116.7266 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="190" y="133.7935">Config: /etc/postfix/master.cf</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="190" y="148.9263">Config: /etc/postfix/main.cf</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="190" y="164.0591">Logs: journalctl -u postfix</text><path d="M658,182.125 L658,207.125 L845,207.125 L845,192.125 L835,182.125 L658,182.125 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M835,182.125 L835,192.125 L845,192.125 L835,182.125 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="664" y="199.1919">Keys: /etc/opendkim/keys/</text><path d="M1049,217.2578 L1049,257.2578 L1326,257.2578 L1326,227.2578 L1316,217.2578 L1049,217.2578 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1316,217.2578 L1316,227.2578 L1326,227.2578 L1316,217.2578 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="1055" y="234.3247">Path: /usr/local/bin/pixel-content-filter.sh</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="1055" y="249.4575">Called by: pipe transport in master.cf</text><path d="M1256,267.5234 L1256,337.5234 L1585,337.5234 L1585,277.5234 L1575,267.5234 L1256,267.5234 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1575,267.5234 L1575,277.5234 L1585,277.5234 L1575,267.5234 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="308" x="1262" y="284.5903">Service: /etc/systemd/system/pixelmilter.service</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="1262" y="299.7231">Binary: /opt/pixel-tracking/pixelmilter</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="1262" y="314.856">Data Dir: /var/lib/pixel-tracking/</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="1262" y="329.9888">Logs: journalctl -u pixelmilter</text><path d="M1439,348.0547 L1439,373.0547 L1675,373.0547 L1675,358.0547 L1665,348.0547 L1439,348.0547 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1665,348.0547 L1665,358.0547 L1675,358.0547 L1665,348.0547 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="1445" y="365.1216">Path: /usr/local/bin/postfix-reinject</text><path d="M1827,383.1875 L1827,453.1875 L2159,453.1875 L2159,393.1875 L2149,383.1875 L1827,383.1875 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2149,383.1875 L2149,393.1875 L2159,393.1875 L2149,383.1875 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="1833" y="400.2544">Service: /etc/systemd/system/pixelserver.service</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="1833" y="415.3872">Binary: /opt/pixel-tracking/pixelserver</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="1833" y="430.52">Data Dir: /var/lib/pixel-tracking/</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="1833" y="445.6528">Logs: journalctl -u pixelserver</text><path d="M2038,463.7188 L2038,503.7188 L2286,503.7188 L2286,473.7188 L2276,463.7188 L2038,463.7188 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2276,463.7188 L2276,473.7188 L2286,473.7188 L2276,463.7188 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="2044" y="480.7856">Path: /var/lib/pixel-tracking/</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="2044" y="495.9185">Shared by: pixelmilter &amp; pixelserver</text><rect fill="#EEEEEE" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2403.5" x="3" y="529.5508"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2406.5" y1="529.5508" y2="529.5508"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2406.5" y1="532.5508" y2="532.5508"/><rect fill="#EEEEEE" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="103" x="1153.25" y="518.9844"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="84" x="1159.25" y="535.0513">Submission</text><polygon fill="#A80036" points="269.5,584.3828,279.5,588.3828,269.5,592.3828,273.5,588.3828" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="49.5" x2="275.5" y1="588.3828" y2="588.3828"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="59" y="575.7505">1</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="120.5" y="568.1841">SMTP (Port 587)</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="72" y="583.3169">EHLO, AUTH, MAIL, RCPT, DATA</text><polygon fill="#A80036" points="447,613.5156,457,617.5156,447,621.5156,451,617.5156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="291.5" x2="453" y1="617.5156" y2="617.5156"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="303.25" y="612.4497">2</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="316.25" y="612.4497">SASL Authentication</text><polygon fill="#A80036" points="302.5,642.6484,292.5,646.6484,302.5,650.6484,298.5,646.6484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="296.5" x2="463" y1="646.6484" y2="646.6484"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="362.25" y="641.5825">3</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="375.25" y="641.5825">OK</text><polygon fill="#A80036" points="636.5,671.7813,646.5,675.7813,636.5,679.7813,640.5,675.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="291.5" x2="642.5" y1="675.7813" y2="675.7813"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="380" y="670.7153">4</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="393" y="670.7153">Milter Protocol (Port 8891)</text><polygon fill="#A80036" points="302.5,700.9141,292.5,704.9141,302.5,708.9141,298.5,704.9141" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="296.5" x2="652.5" y1="704.9141" y2="704.9141"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="358.5" y="699.8481">5</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="215" x="371.5" y="699.8481">Signed Headers (DKIM-Signature)</text><polygon fill="#A80036" points="831,730.0469,841,734.0469,831,738.0469,835,734.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="286.5" x2="837" y1="734.0469" y2="734.0469"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="499.75" y="728.981">6</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="512.75" y="728.981">Enqueue Message</text><rect fill="#EEEEEE" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2403.5" x="3" y="762.6133"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2406.5" y1="762.6133" y2="762.6133"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2406.5" y1="765.6133" y2="765.6133"/><rect fill="#EEEEEE" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="262" x="1073.75" y="752.0469"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="243" x="1079.75" y="768.1138">Content Filtering (Pixel Injection)</text><path d="M848,790.1797 L848,830.1797 L1070,830.1797 L1070,800.1797 L1060,790.1797 L848,790.1797 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1060,790.1797 L1060,800.1797 L1070,800.1797 L1060,790.1797 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="854" y="807.2466">Triggered by master.cf:</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="201" x="854" y="822.3794">content_filter=pixelcontentfilter</text><polygon fill="#A80036" points="1027,867.7109,1037,871.7109,1027,875.7109,1031,871.7109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="843" x2="1033" y1="871.7109" y2="871.7109"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="853" y="859.0786">7</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="907" y="851.5122">Pipe (spawn)</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="33" x="866" y="866.645">Args:</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="56" x="903" y="866.645">sender X</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="963" y="866.645">recipient Y</text><polygon fill="#A80036" points="1234.5,911.9766,1244.5,915.9766,1234.5,919.9766,1238.5,915.9766" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1049" x2="1240.5" y1="915.9766" y2="915.9766"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1096.25" y="903.3442">8</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1118.25" y="895.7778">Pipe (stdin)</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="1109.25" y="910.9106">Email Content</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1256.5" x2="1298.5" y1="960.2422" y2="960.2422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1298.5" x2="1298.5" y1="960.2422" y2="973.2422"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1257.5" x2="1298.5" y1="973.2422" y2="973.2422"/><polygon fill="#A80036" points="1267.5,969.2422,1257.5,973.2422,1267.5,977.2422,1263.5,973.2422" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="1263.5" y="947.6099">9</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="1276.5" y="940.0435">Inject Tracking Pixel</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="81" x="1276.5" y="955.1763">(&lt;img&gt; tag)</text><polygon fill="#A80036" points="2021.5,1013.5078,2031.5,1017.5078,2021.5,1021.5078,2025.5,1017.5078" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1256.5" x2="2027.5" y1="1017.5078" y2="1017.5078"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1534" y="1004.8755">10</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="1607.5" y="997.3091">Write Metadata</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="1556" y="1012.4419">(MessageID, Sender, Recipient)</text><polygon fill="#A80036" points="1060,1042.6406,1050,1046.6406,1060,1050.6406,1056,1046.6406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1054" x2="1250.5" y1="1046.6406" y2="1046.6406"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1065.75" y="1041.5747">11</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="1087.75" y="1041.5747">Modified Email (stdout)</text><polygon fill="#A80036" points="1417,1086.9063,1427,1090.9063,1417,1094.9063,1421,1090.9063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1049" x2="1423" y1="1090.9063" y2="1090.9063"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1146.5" y="1078.2739">12</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1214" y="1070.7075">Pipe (stdin)</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="33" x="1168.5" y="1085.8403">Args:</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="56" x="1205.5" y="1085.8403">sender X</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="1265.5" y="1085.8403">recipient Y</text><polygon fill="#A80036" points="1621,1161.4375,1631,1165.4375,1621,1169.4375,1625,1165.4375" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1439" x2="1627" y1="1165.4375" y2="1165.4375"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1448.5" y="1137.6724">13</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="1470.5" y="1114.9731">SMTP (127.0.0.1:10025)</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="1504" y="1130.106">MAIL FROM: X</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="1513" y="1145.2388">RCPT TO: Y</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="35" x="1529.5" y="1160.3716">DATA</text><polygon fill="#A80036" points="854,1205.7031,844,1209.7031,854,1213.7031,850,1209.7031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="848" x2="1637" y1="1209.7031" y2="1209.7031"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1170.5" y="1197.0708">14</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="1193" y="1189.5044">Enqueue Message</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1192.5" y="1204.6372">(No Content Filter)</text><polygon fill="#A80036" points="1060,1234.8359,1050,1238.8359,1060,1242.8359,1056,1238.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1054" x2="1433" y1="1238.8359" y2="1238.8359"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1204" y="1233.77">15</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="1226" y="1233.77">Success</text><polygon fill="#A80036" points="854,1263.9688,844,1267.9688,854,1271.9688,850,1267.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="848" x2="1043" y1="1267.9688" y2="1267.9688"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="881.5" y="1262.9028">16</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="903.5" y="1262.9028">Exit 0 (Success)</text><rect fill="#EEEEEE" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2403.5" x="3" y="1296.5352"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2406.5" y1="1296.5352" y2="1296.5352"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2406.5" y1="1299.5352" y2="1299.5352"/><rect fill="#EEEEEE" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="78" x="1165.75" y="1285.9688"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="59" x="1171.75" y="1302.0356">Delivery</text><polygon fill="#A80036" points="2158.5,1351.3672,2168.5,1355.3672,2158.5,1359.3672,2162.5,1355.3672" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="843" x2="2164.5" y1="1355.3672" y2="1355.3672"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1448.25" y="1342.7349">17</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="1470.25" y="1335.1685">SMTP (Port 25)</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="1492.25" y="1350.3013">Delivery</text><polygon fill="#A80036" points="854,1380.5,844,1384.5,854,1388.5,850,1384.5" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="848" x2="2174.5" y1="1384.5" y2="1384.5"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1475.25" y="1379.4341">18</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="1497.25" y="1379.4341">250 OK</text><rect fill="#EEEEEE" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2403.5" x="3" y="1413.0664"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2406.5" y1="1413.0664" y2="1413.0664"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2406.5" y1="1416.0664" y2="1416.0664"/><rect fill="#EEEEEE" height="23.1328" style="stroke: #000000; stroke-width: 2.0;" width="82" x="1163.75" y="1402.5"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="63" x="1169.75" y="1418.5669">Tracking</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="2297.5" x2="2339.5" y1="1456.7656" y2="1456.7656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2339.5" x2="2339.5" y1="1456.7656" y2="1469.7656"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2298.5" x2="2339.5" y1="1469.7656" y2="1469.7656"/><polygon fill="#A80036" points="2308.5,1465.7656,2298.5,1469.7656,2308.5,1473.7656,2304.5,1469.7656" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2304.5" y="1451.6997">19</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="2326.5" y="1451.6997">Open Email</text><polygon fill="#A80036" points="1838.5,1510.0313,1828.5,1514.0313,1838.5,1518.0313,1834.5,1514.0313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1832.5" x2="2296.5" y1="1514.0313" y2="1514.0313"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1995" y="1501.3989">20</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="2025" y="1493.8325">HTTPS Request</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="2017" y="1508.9653">(GET /pixel?id=...)</text><polygon fill="#A80036" points="2021.5,1554.2969,2031.5,1558.2969,2021.5,1562.2969,2025.5,1558.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1827.5" x2="2027.5" y1="1558.2969" y2="1558.2969"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="1839.5" y="1545.6646">21</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="1885.5" y="1538.0981">Update Metadata</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="1861.5" y="1553.231">(Mark as Opened, IP, UA)</text><polygon fill="#A80036" points="2285.5,1583.4297,2295.5,1587.4297,2285.5,1591.4297,2289.5,1587.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1822.5" x2="2291.5" y1="1587.4297" y2="1587.4297"/><text fill="#000000" font-family="Helvetica" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="2025.5" y="1582.3638">22</text><text fill="#000000" font-family="Helvetica" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="2047.5" y="1582.3638">1x1 GIF</text><!--MD5=[0fe9a278d85af87b49c72ab520008a82]
@startuml
autonumber
skinparam participantPadding 20
skinparam boxPadding 10
skinparam monochrome false
skinparam shadowing false
skinparam defaultFontName Helvetica
skinparam sequenceMessageAlign center

actor "User (MUA)" as User
box "Mail Server Host (Debian/Ubuntu)" #F0F8FF
    participant "Postfix\n(postfix.service)" as PostfixSubmission
    note over PostfixSubmission
        Config: /etc/postfix/master.cf
        Config: /etc/postfix/main.cf
        Logs: journalctl -u postfix
    end note

    participant "Dovecot\n(dovecot.service)" as Dovecot
    
    participant "OpenDKIM\n(opendkim.service)" as OpenDKIM
    note right of OpenDKIM
        Keys: /etc/opendkim/keys/
    end note

    participant "Postfix\n(Queue/Cleanup)" as PostfixQueue
    
    participant "Content Filter\n(pixel-content-filter.sh)" as ContentFilter
    note right of ContentFilter
        Path: /usr/local/bin/pixel-content-filter.sh
        Called by: pipe transport in master.cf
    end note

    participant "Pixel Milter\n(pixelmilter.service)" as PixelMilter
    note right of PixelMilter
        Service: /etc/systemd/system/pixelmilter.service
        Binary: /opt/pixel-tracking/pixelmilter
        Data Dir: /var/lib/pixel-tracking/
        Logs: journalctl -u pixelmilter
    end note

    participant "Postfix Reinject\n(Binary)" as Reinject
    note right of Reinject
        Path: /usr/local/bin/postfix-reinject
    end note

    participant "Postfix\n(smtpd:10025)" as PostfixReinjectListener
    
    participant "Pixel Server\n(pixelserver.service)" as PixelServer
    note right of PixelServer
        Service: /etc/systemd/system/pixelserver.service
        Binary: /opt/pixel-tracking/pixelserver
        Data Dir: /var/lib/pixel-tracking/
        Logs: journalctl -u pixelserver
    end note

    database "Shared Data\n(JSON/Logs)" as DB
    note right of DB
        Path: /var/lib/pixel-tracking/
        Shared by: pixelmilter & pixelserver
    end note
end box
participant "Recipient MTA" as Internet
actor "Recipient" as Recipient

== Submission ==
User -> PostfixSubmission: SMTP (Port 587)\nEHLO, AUTH, MAIL, RCPT, DATA
activate PostfixSubmission

PostfixSubmission -> Dovecot: SASL Authentication
activate Dovecot
Dovecot - -> PostfixSubmission: OK
deactivate Dovecot

PostfixSubmission -> OpenDKIM: Milter Protocol (Port 8891)
activate OpenDKIM
OpenDKIM - -> PostfixSubmission: Signed Headers (DKIM-Signature)
deactivate OpenDKIM

PostfixSubmission -> PostfixQueue: Enqueue Message
deactivate PostfixSubmission

== Content Filtering (Pixel Injection) ==
note right of PostfixQueue
  Triggered by master.cf:
  content_filter=pixelcontentfilter
end note

PostfixQueue -> ContentFilter: Pipe (spawn)\nArgs: - -sender X - -recipient Y
activate ContentFilter

ContentFilter -> PixelMilter: Pipe (stdin)\nEmail Content
activate PixelMilter
PixelMilter -> PixelMilter: Inject Tracking Pixel\n(<img> tag)
PixelMilter -> DB: Write Metadata\n(MessageID, Sender, Recipient)
PixelMilter - -> ContentFilter: Modified Email (stdout)
deactivate PixelMilter

ContentFilter -> Reinject: Pipe (stdin)\nArgs: - -sender X - -recipient Y
activate Reinject
Reinject -> PostfixReinjectListener: SMTP (127.0.0.1:10025)\nMAIL FROM: X\nRCPT TO: Y\nDATA
activate PostfixReinjectListener
PostfixReinjectListener -> PostfixQueue: Enqueue Message\n(No Content Filter)
deactivate PostfixReinjectListener
Reinject - -> ContentFilter: Success
deactivate Reinject

ContentFilter - -> PostfixQueue: Exit 0 (Success)
deactivate ContentFilter

== Delivery ==
PostfixQueue -> Internet: SMTP (Port 25)\nDelivery
activate Internet
Internet - -> PostfixQueue: 250 OK
deactivate Internet

== Tracking ==
Recipient -> Recipient: Open Email
Recipient -> PixelServer: HTTPS Request\n(GET /pixel?id=...)
activate PixelServer
PixelServer -> DB: Update Metadata\n(Mark as Opened, IP, UA)
PixelServer - -> Recipient: 1x1 GIF
deactivate PixelServer

@enduml

PlantUML version 1.2020.02(Sun Mar 01 13:52:07 IRST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 17.0.17+10-Debian-1deb12u1
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>