# Generated by mailserver
myhostname = {{ hostname }}
mydomain = {{ mydomain }}
myorigin = $mydomain
mydestination = localhost
inet_interfaces = all
inet_protocols = all

# Disable local alias database (we only use virtual domains)
alias_maps =
alias_database =

# Virtual mailbox delivery via Dovecot LMTP
virtual_transport = lmtp:inet:localhost:24
virtual_mailbox_domains = lmdb:/etc/postfix/virtual_domains
virtual_mailbox_maps = lmdb:/etc/postfix/vmailbox
virtual_alias_maps = lmdb:/etc/postfix/virtual_aliases

# SASL auth via Dovecot
smtpd_sasl_type = dovecot
smtpd_sasl_path = inet:localhost:12345
smtpd_sasl_auth_enable = yes
smtpd_sasl_security_options = noanonymous

# TLS
smtpd_tls_cert_file = /data/ssl/cert.pem
smtpd_tls_key_file = /data/ssl/key.pem
smtpd_tls_security_level = may
smtpd_tls_auth_only = yes
smtp_tls_security_level = may

# Milters
smtpd_milters = inet:localhost:8891
non_smtpd_milters = inet:localhost:8891
milter_default_action = accept

# Content filter for pixel injection
content_filter = pixelfilter:dummy

# Sender login maps â€” allow accounts to send as their aliases
smtpd_sender_login_maps = lmdb:/etc/postfix/sender_login_maps
smtpd_sender_restrictions = reject_authenticated_sender_login_mismatch, permit

# Restrictions
smtpd_recipient_restrictions = permit_sasl_authenticated, permit_mynetworks, reject_unauth_destination

# Client restrictions - allow connections while reducing reverse DNS warnings
# Note: Many legitimate clients have incomplete reverse DNS, so we permit by default
# while maintaining other security restrictions (auth, recipient validation)
smtpd_client_restrictions = permit_mynetworks, permit_sasl_authenticated, permit
disable_vrfy_command = yes

# Limits
message_size_limit = 31457280
