{% extends "layout.html" %}
{% block title %}Mail Queue{% endblock %}
{% block content %}
<h1>Mail Queue</h1>
<p>Current Postfix queue from <code>postqueue -p</code>.</p>
<div class="queue-actions">
  <form method="post" action="/queue/flush" onsubmit="return confirm('Flush the mail queue now?')">
    <button type="submit">Flush Queue</button>
  </form>
  <form method="post" action="/queue/purge" onsubmit="return confirm('Purge ALL messages from the queue? This cannot be undone.')">
    <button type="submit" class="button-danger">Purge Queue</button>
  </form>
</div>

{% if let Some(err) = error %}
  <p class="text-danger"><strong>Error:</strong> <em>{{ err }}</em></p>
{% else if entries.is_empty() %}
  <p><em>Mail queue is empty.</em></p>
{% else %}
  {% if !queue_summary.is_empty() %}<p><small>{{ queue_summary }}</small></p>{% endif %}
  <div class="table-wrap">
  <table>
    <thead>
      <tr>
        <th>Queue ID</th>
        <th>Size</th>
        <th>Arrival Time</th>
        <th>Sender</th>
        <th>Recipients</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
    {% for entry in entries %}
      <tr>
        <td><code>{{ entry.id }}</code></td>
        <td>{{ entry.size }}</td>
        <td><small>{{ entry.arrival_time }}</small></td>
        <td><code>{{ entry.sender }}</code></td>
        <td>
          {% for rcpt in entry.recipients %}
            <div><small>{{ rcpt }}</small></div>
          {% endfor %}
        </td>
        <td class="nowrap">
          <form method="post" action="/queue/{{ entry.id }}/flush" class="form-inline">
            <button type="submit">Retry</button>
          </form>
          <form method="post" action="/queue/{{ entry.id }}/delete" class="form-inline" onsubmit="return confirm('Delete message {{ entry.id }}?')">
            <button type="submit" class="button-danger">Delete</button>
          </form>
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  </div>
{% endif %}
{% endblock %}
