{% extends "layout.html" %}
{% block title %}Compose Email{% endblock %}
{% block content %}
<h1>Compose Email</h1>
<form method="post" action="/webmail/send">
  <fieldset>
    <label for="account_id">From Account:</label>
    <select name="account_id" id="account_id" required>
      <option value="">— Select account —</option>
      {% for a in accounts %}
      <option value="{{ a.id }}"{% if let Some(sel) = selected_account %}{% if sel.id == a.id %} selected{% endif %}{% endif %}>{{ a.username }}@{{ a.domain_name.as_deref().unwrap_or("?") }}</option>
      {% endfor %}
    </select>

    <label for="sender_name">Sender Name (optional):</label>
    <input type="text" name="sender_name" id="sender_name" placeholder="Display Name">

    <label for="from_address">From Address (optional, overrides account address):</label>
    <input type="text" name="from_address" id="from_address" placeholder="custom@example.com or Display Name &lt;custom@example.com&gt;">

    <label for="to">To:</label>
    <input type="text" name="to" id="to" required placeholder="recipient@example.com">

    <label for="cc">CC (optional):</label>
    <input type="text" name="cc" id="cc" placeholder="cc1@example.com, cc2@example.com">

    <label for="bcc">BCC (optional):</label>
    <input type="text" name="bcc" id="bcc" placeholder="bcc@example.com">

    <label for="reply_to">Reply-To (optional):</label>
    <input type="text" name="reply_to" id="reply_to" placeholder="reply@example.com">

    <label for="subject">Subject (optional):</label>
    <input type="text" name="subject" id="subject">

    <label for="in_reply_to">In-Reply-To (optional):</label>
    <input type="text" name="in_reply_to" id="in_reply_to" placeholder="&lt;message-id@example.com&gt;">

    <label for="priority">Priority:</label>
    <select name="priority" id="priority">
      <option value="normal" selected>Normal</option>
      <option value="lowest">Lowest</option>
      <option value="low">Low</option>
      <option value="high">High</option>
      <option value="highest">Highest</option>
    </select>

    <label for="body_format">Body Format:</label>
    <select name="body_format" id="body_format">
      <option value="plain" selected>Plain Text</option>
      <option value="html">HTML</option>
      <option value="both">Both (Plain + HTML)</option>
    </select>

    <label for="body">Body:</label>
    <textarea name="body" id="body" rows="12"></textarea>

    <label for="custom_headers">Custom Headers (optional, one per line, format: Name: value):</label>
    <textarea name="custom_headers" id="custom_headers" rows="3" placeholder="X-Custom-Header: value"></textarea>

    <button type="submit">Send</button>
  </fieldset>
</form>

{% if !send_log.is_empty() %}
<details open>
  <summary>Send Log</summary>
  <pre>{% for line in send_log %}{{ line }}
{% endfor %}</pre>
</details>
{% endif %}
{% endblock %}
