protocols = imap
listen = *

# Maildir layout: /var/mail/vhosts/<domain>/<user>/
mail_home = /var/mail/vhosts/%d/%n
mail_location = maildir:/var/mail/vhosts/%d/%n

# TLS (reuse same certs as Postfix)
ssl = required
ssl_cert = </certs/mailserver.crt
ssl_key  = </certs/mailserver.key

auth_mechanisms = plain login

# Simple passdb/userdb using a local file
passdb {
  driver = passwd-file
  args = scheme=SHA512-CRYPT /etc/dovecot/users
}
userdb {
  driver = static
  args = uid=vmail gid=vmail home=/var/mail/vhosts/%d/%n
}

# Run vmail user inside container (ensure it exists in image or via entrypoint)
first_valid_uid = 100
first_valid_gid = 100

# Postfix SASL over TCP
service auth {
  inet_listener submission_auth {
    port = 12345
    # Optional: bind only on docker network interface
    # address = 0.0.0.0
  }
}

# Recommended performance/indexes
mail_plugins = $mail_plugins
namespace inbox {
  inbox = yes
}
